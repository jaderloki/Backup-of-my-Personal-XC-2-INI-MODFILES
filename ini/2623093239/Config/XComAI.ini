;---------------------------------------------------------------------------------------
;  FILE:   RustyBearers Configs - Ai
;
;	CREATED ON	24/09/21	11:30
;	LAST UPDATE	09/10/21	04:00
;
;---------------------------------------------------------------------------------------
[XComGame.X2AIBTBehaviorTree]

; *********************************************************************************************************************
; ***                                            Equivalent Abilities                                               ***
; *********************************************************************************************************************
+EquivalentAbilities=( KeyName=EnergyShield_Rusty, \\
                                EquivalentAbilityName[0]=EnergyShield, \\
                                EquivalentAbilityName[1]=EnergyShieldMk3, \\
                                EquivalentAbilityName[2]=NullWard, \\
                                EquivalentAbilityName[3]=Rusty_CloistaShield, \\
                                EquivalentAbilityName[4]=Rusty_WarSuitShield, \\
                                EquivalentAbilityName[5]=ShieldBurst_Blue, \\
                                EquivalentAbilityName[6]=ShieldBurst_Green, \\
                                EquivalentAbilityName[7]=ShieldBurst_Psi, \\
                                EquivalentAbilityName[8]=ShieldBurst_Fire \\
                                )

+EquivalentAbilities=(KeyName=StandardMelee, EquivalentAbilityName[0]=ShieldBash)

; *********************************************************************************************************************
; *********************************************************************************************************************

; --------------------- Best Positioning ----------------------------------------
+Behaviors=(BehaviorName=HasMultipleEnergyShield_RustyTargets, NodeType=StatCondition, \\
                Param[0]=AbilityTargetUnitCount-EnergyShield_Rusty, Param[1]=">=", Param[2]=3) ; Param[2] count includes self.

+Behaviors=(BehaviorName=HasAnyEnergyShield_RustyTargets, NodeType=StatCondition, \\
                Param[0]=AbilityTargetUnitCount-EnergyShield_Rusty, Param[1]=">=", Param[2]=2)

; Requires a potential target.  Used for finding a destination to shield our 'best' unit.
+Behaviors=(BehaviorName=RestrictToPotentialTargetRange-EnergyShield_Rusty, NodeType=Action)

; RestrictToAlliedAbilityRange does not require a potential target - instead it considers all destinations within ability range of at least Param[0] allies.
+Behaviors=(BehaviorName=RestrictToAlliedAbilityRange-EnergyShield_Rusty, NodeType=Action, Param[0]=2) ;Param[0] is the minimum number of Allied Targets in range for each tile to be considered.

+Behaviors=(BehaviorName=AddAbilityRangeWeight-EnergyShield_Rusty, NodeType=Action, Param[0]="5.5")

+Behaviors=(BehaviorName=FindShieldDestinationDefensive_Rusty, NodeType=Selector, \\
                Child[0]=FindShieldDestinationDefensive_Rusty_MultipleUnits, \\
                Child[1]=FindShieldDestinationDefensive_Rusty_BestUnit)

+Behaviors=(BehaviorName=FindShieldDestinationDefensive_Rusty_MultipleUnits, NodeType=Sequence, \\
                Child[0]=ResetDestinationSearch, \\
                Child[1]=RestrictToAlliedAbilityRange-EnergyShield_Rusty, \\
                Child[2]=AddAbilityRangeWeight-EnergyShield_Rusty, \\
                Child[3]=FindRestrictedDestination-MWP_Defensive)

+Behaviors=(BehaviorName=FindShieldDestinationDefensive_Rusty_BestUnit, NodeType=Sequence, \\
                Child[0]=SelectPotentialTargetForEnergyShield_Rusty, \\
                Child[1]=ResetDestinationSearch, \\
                Child[2]=RestrictToPotentialTargetRange-EnergyShield_Rusty, \\
                Child[3]=FindRestrictedDestination-MWP_Defensive)

; --------------------- Standard Melee ----------------------------------------
+Behaviors=(BehaviorName=IsTargetInMovementRange-EnergyShield_Rusty, NodeType=Condition)
+Behaviors=(BehaviorName=IsAbilityAvailable-EnergyShield_Rusty, NodeType=Condition)
+Behaviors=(BehaviorName=IsAbilityReady-EnergyShield_Rusty, NodeType=Condition)

; ---------------- Select Ability Nodes ---------------------------------------
+Behaviors=(BehaviorName=SelectAbility-EnergyShield_Rusty, NodeType=Action)

; ---------------- Ability Handlers ---------------------------------------------------------------
; ---------------- Move Handlers ----------------------------------------------
+Behaviors=(BehaviorName=MoveStandardIfFirstAbility-EnergyShield_Rusty, NodeType=Sequence, \\
                Child[0]=IsAbilityAvailable-StandardMove, \\
                Child[1]=NotLastActionPoint, \\
                Child[2]=FindShieldDestinationDefensive_Rusty, \\
                Child[3]=SelectAbility-StandardMove)

; ---------------- Energy Shield (Shieldbearer) -------------------------------
+Behaviors=(BehaviorName=TryEnergyShield_RustyOnMultipleTargets, NodeType=Sequence, \\
                Child[0]=IsAbilityAvailable-EnergyShield_Rusty, \\
                Child[1]=HasMultipleEnergyShield_RustyTargets, \\
                Child[2]=SelectAbility-EnergyShield_Rusty)

+Behaviors=(BehaviorName=TryEnergyShield_RustyOnAnyTarget, NodeType=Sequence, \\
                Child[0]=IsAbilityAvailable-EnergyShield_Rusty, \\
                Child[1]=HasAnyEnergyShield_RustyTargets, \\
                Child[2]=SelectAbility-EnergyShield_Rusty)

+Behaviors=(BehaviorName=SelectPotentialTargetForEnergyShield_Rusty, NodeType=Sequence, \\
                Child[0]=SetPotentialAllyTargetStack, \\
                Child[1]=SelectBestAllyTargetForEnergyShield_Rusty, \\
                Child[2]=HasValidTarget-Potential)

+Behaviors=(BehaviorName=SelectBestAllyTargetForEnergyShield_Rusty, NodeType=RepeatUntilFail, Child[0]=EvaluatePotentialEnergyShield_RustyTarget)

+Behaviors=(BehaviorName=EvaluatePotentialEnergyShield_RustyTarget, NodeType=Sequence, \\
				Child[0]=SetNextTarget, \\
				Child[1]=ScoreBestTargetForEnergyShield_Rusty, \\
				Child[2]=UpdateBestTarget)

+Behaviors=(BehaviorName=ScoreBestTargetForEnergyShield_Rusty, NodeType=Successor, Child[0]=TargetScoreReachableForEnergyShield_Rusty)

+Behaviors=(BehaviorName=TargetScoreReachableForEnergyShield_Rusty, NodeType=Sequence, \\
				Child[0]=IsTargetInMovementRange-EnergyShield_Rusty, \\
				Child[1]=AvoidBoundAndPanickedTargets, \\
				Child[2]=ScoreByHP)

; --------------- ADVENT ShieldBearer RUSTY AI BEHAVIOR TREE NODES BEGIN -------
; energy shield looking for multiple targets disabled, because currently, it only targets self.
; Energy Shield is Active(ET)
+Behaviors=(BehaviorName="AdventShieldBearer_Rusty::CharacterRoot", NodeType=Selector, \\
				Child[0]=TryJob, \\
                Child[1]=GenericGreenMovement, \\
				Child[2]=AdventShieldBearer_Rusty_RedAlert, \\
				Child[3]=GenericAlertHandler)

+Behaviors=(BehaviorName=AdventShieldBearer_Rusty_RedAlert, NodeType=Sequence, \\
				Child[0]=IsRedAlert, \\
				Child[1]=AdventShieldBearer_Rusty_RedAbilitySelector)

+Behaviors=(BehaviorName=AdventShieldBearer_Rusty_RedAbilitySelector, NodeType=Selector, \\
				Child[0]=MimicBeaconBehavior, \\
				Child[1]=ShieldBearerFirstAction_Rusty, \\
				Child[2]=ShieldBearerLastAction_Rusty)

+Behaviors=(BehaviorName=ShieldBearerFirstAction_Rusty, NodeType=Sequence, \\
				Child[0]=NotLastActionPoint, \\
				Child[1]=ShieldBearerFirstActionSelector_Rusty)

+Behaviors=(BehaviorName=ShieldBearerFirstActionSelector_Rusty, NodeType=Selector, \\
                Child[0]=TryMoveForEnergyShield_Rusty, \\
                Child[1]=TryEnergyShield_RustyOnMultipleTargets, \\
                Child[2]=TryMoveThenGrenade, \\
                Child[3]=DoIfFlankedMove, \\
                Child[4]=TryRustyBearerStuff, \\
                Child[5]=HuntEnemyWithCover, \\
                Child[6]=SelectMove_JobOrDefensive)

+Behaviors=(BehaviorName=TryRustyBearerStuff, NodeType=RandSelector, \\
                Child[0]=TryStandardMelee,            Param[0]=50, \\
                Child[1]=TryShootOrReloadOrOverwatch, Param[1]=50  )

+Behaviors=(BehaviorName=TryMoveForEnergyShield_Rusty, NodeType=Sequence, \\
                Child[0]=SafeToMove, \\
                Child[1]=IsAbilityReady-EnergyShield_Rusty, \\
                Child[2]=NotLastActionPoint, \\
                Child[3]=MoveStandardIfFirstAbility-EnergyShield_Rusty)

+Behaviors=(BehaviorName=ShieldBearerLastAction_Rusty, NodeType=Sequence, \\
				Child[0]=IsLastActionPoint, \\
				Child[1]=ShieldBearerLastActionSelector_Rusty)

+Behaviors=(BehaviorName=ShieldBearerLastActionSelector_Rusty, NodeType=Selector, \\
                Child[0]=TryEnergyShield_RustyOnAnyTarget, \\
                Child[1]=TryShootOrReloadOrOverwatch,  \\
                Child[2]=HuntEnemyWithCover, \\
                Child[3]=SelectMove_JobOrDefensive)
